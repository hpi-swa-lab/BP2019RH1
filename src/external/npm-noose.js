"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t,o){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(t,o):"function"==typeof define&&define.amd?define((function(){return e(t,o)})):t.Noose=e(t,o)}((function(e,t){function o(){}var r=Math.min,n=Math.max,s="px",i={classes:{noose:"noose",selected:"selected"},compute:!0,container:"body",containers:[],ctrl:!0,enabled:!0,mode:"touch",move:o,scroll:10,scrollEdge:10,scrollbar:17,select:"*",shift:!0,start:o,stop:o,style:{border:"1px dotted #000",zIndex:1e3},throttle:200};return function(){function o(l,c){_classCallCheck(this,o);var a=this;if("object"!==_typeof(l)||null==l||l instanceof HTMLElement||(c=l,l=null),c=a.opts=Object.assign({},i,c),("string"==typeof l||l instanceof HTMLElement)&&(c.container=l),c.container instanceof HTMLElement)a.containers=[c.container];else{if("string"!=typeof c.container)throw new Error("Invalid container option");a.containers=Array.prototype.slice.call(t.querySelectorAll(c.container))}a.coors={pointer:{},noose:{},container:{}};var u=a.noose=t.createElement("div");u.style.position="absolute",u.style.zIndex=c.style.zIndex,u.style.border=c.style.border,c.classes.noose&&u.classList.add(c.classes.noose);var d=!1,y=!1;return a._onStart=function(t){var o=t.currentTarget===a.currentTarget;if(c.enabled&&(!d||!o)&&("mousedown"!==t.type||1===t.which)){d=!0;var s=a.currentTarget=t.currentTarget,i=a.coors.container,l=a.coors.pointer,y=a.coors.noose,p=e.getComputedStyle(s);"static"===p.position&&console.warn("Container is not a positioned element. This may cause issues positioning the noose and/or selecting elements."),c.scroll>0&&c.scrollEdge>0?(i.scrollX=("auto"===p.overflowX||"scroll"===p.overflowX)&&s.scrollHeight>s.clientHeight,i.scrollY=("auto"===p.overflowY||"scroll"===p.overflowY)&&s.scrollWidth>s.clientWidth):(i.scrollX=!1,i.scrollY=!1),i.maxScrollY=i.scrollY&&s.scrollHeight-s.clientHeight||0,i.maxScrollX=i.scrollX&&s.scrollWidth-s.clientWidth||0;var f=l.start,h=l.end;if(l.start=null,y.start=null,a.updateContainerPosition().updatePointerPosition(t),c.scrollbar&&(i.scrollX&&l.end.x>i.x+i.w-c.scrollbar||i.scrollY&&l.end.y>i.y+i.h-c.scrollbar))return d=!1,l.start=f,void(l.end=h);if(c.shift&&o&&t.shiftKey&&f){var v=y.top,m=y.bottom,x=Math.floor((f.x+h.x)/2),g=Math.floor((f.y+h.y)/2);y.start={},l.start.x>=x&&l.start.y<g?(l.start.x=r(f.x,h.x),l.start.y=n(f.y,h.y),y.start.x=v.x,y.start.y=m.y):l.start.x<x&&l.start.y<=g?(l.start.x=n(f.x,h.x),l.start.y=n(f.y,h.y),y.start=m):l.start.x<=x&&l.start.y>g?(l.start.x=n(f.x,h.x),l.start.y=r(f.y,h.y),y.start.x=m.x,y.start.y=v.y):l.start.x>x&&l.start.y>=g&&(l.start.x=r(f.x,h.x),l.start.y=r(f.y,h.y),y.start=v)}if(c.ctrl&&o&&t.ctrlKey?a.lastSelection=a.selected||[]:a.lastSelection=[],u.style.display="none",!1===c.start.apply(a,[t,a.coors]))return d=!1,l.start=f,void(l.end=h);s.appendChild(u)}},a._onMove=function(e){if(c.enabled&&d&&e.currentTarget===a.currentTarget){e.cancelable&&e.preventDefault(),"scroll"!==e.type&&a.updatePointerPosition(e),a.updateContainerPosition().updateNoosePosition();var t=a.coors.noose.top,o=a.coors.noose.bottom;u.style.left=t.x+s,u.style.top=t.y+s,u.style.width=o.x-t.x+s,u.style.height=o.y-t.y+s,u.style.display="block";var r=a.currentTarget,n=a.coors.container,i=a.coors.pointer.end;n.scrollY&&i.y-n.y<c.scrollEdge?r.scrollTop-=c.scroll:n.scrollY&&r.scrollTop<n.maxScrollY&&n.y+n.h-i.y<c.scrollEdge?r.scrollTop+=c.scroll:n.scrollX&&i.x-n.x<c.scrollEdge?r.scrollLeft-=c.scroll:n.scrollX&&r.scrollLeft<n.maxScrollX&&n.x+n.w-i.x<c.scrollEdge&&(r.scrollLeft+=c.scroll),c.compute&&(c.throttle?y||(y=!0,setTimeout((function(){y&&a.compute()&&c.move.apply(a,[e,a.coors,a.selected]),y=!1}),c.throttle)):(a.compute(),c.move.apply(a,[e,a.coors,a.selected])))}},a._onEnd=function(e){a.opts.enabled&&d&&("mouseup"!==e.type||1===e.which)&&(d=!1,e.currentTarget===a.currentTarget&&(a.updateContainerPosition().updatePointerPosition(e).updateNoosePosition(),y=!1,c.compute&&a.compute(!0),setTimeout((function(){c.stop.apply(a,[e,a.coors,a.selected])}),0),a.currentTarget.removeChild(u)))},a.containers.forEach((function(e){a._register(e)})),a}return _createClass(o,[{key:"destroy",value:function(){var e=this;return e.containers.forEach((function(t){e._deregister(t)})),e.noose.remove(),e.noose=null,e}},{key:"updateContainerPosition",value:function(){var t=this.coors.container,o=this.currentTarget.getBoundingClientRect();return t.x=o.left+e.pageXOffset,t.y=o.top+e.pageYOffset,t.w=o.width,t.h=o.height,this}},{key:"updatePointerPosition",value:function(e){var t=e&&e.touches&&e.touches[0]||e,o=this.coors.pointer;return t&&"number"==typeof t.pageX&&(o.end={x:t.pageX,y:t.pageY},o.start||(o.start=o.end)),this}},{key:"updateNoosePosition",value:function(){var e=this.currentTarget,t=this.coors.pointer.end,o=this.coors.container,s=this.coors.noose,i=n(t.x-o.x+e.scrollLeft,0),l=n(t.y-o.y+e.scrollTop,0);return s.start||(s.start={x:i,y:l}),s.top={x:r(s.start.x,i),y:r(s.start.y,l)},s.bottom={x:r(n(s.start.x,i),e.scrollWidth),y:r(n(s.start.y,l),e.scrollHeight)},this}},{key:"compute",value:function(){var t=this;if(t.opts.select){var o=t.opts.classes.selected,r=t.currentTarget,n=r.querySelectorAll(t.opts.select),s=t.coors.noose.top,i=t.coors.noose.bottom,l=t.coors.container.x,c=t.coors.container.y;t.selected=[],Array.prototype.forEach.call(n,(function(n){if(n!==t.noose){var a,u=n.getBoundingClientRect(),d=u.left+e.pageXOffset-l+r.scrollLeft,y=u.top+e.pageYOffset-c+r.scrollTop,p=u.width+d,f=u.height+y;a="fit"===t.opts.mode?s.x<=d&&s.y<=y&&i.x>=p&&i.y>=f:!(s.x>p||s.y>f||i.x<d||i.y<y);var h=t.lastSelection.indexOf(n);a&&-1===h||!a&&-1!==h?(o&&n.classList.add(o),t.selected.push(n)):o&&n.classList.remove(o)}}))}return t}},{key:"_deregister",value:function(e){return e.removeEventListener("mousedown",this._onStart),e.removeEventListener("touchstart",this._onStart),e.removeEventListener("mousemove",this._onMove),e.removeEventListener("touchmove",this._onMove),e.removeEventListener("scroll",this._onMove),e.removeEventListener("mouseup",this._onEnd),e.removeEventListener("touchend",this._onEnd),delete e.noose,this}},{key:"deregister",value:function(e){var t=this.containers.indexOf(e);return t>-1&&"function"==typeof e.removeEventListener&&(this._deregister(e),this.containers.splice(t,1)),this}},{key:"_register",value:function(e){return e.addEventListener("mousedown",this._onStart),e.addEventListener("touchstart",this._onStart,!1),e.addEventListener("mousemove",this._onMove),e.addEventListener("touchmove",this._onMove,!1),e.addEventListener("scroll",this._onMove),e.addEventListener("mouseup",this._onEnd),e.addEventListener("touchend",this._onEnd,!1),e.noose=this}},{key:"register",value:function(e){return-1===this.containers.indexOf(e)&&"function"==typeof e.addEventListener&&(this._register(e),this.containers.push(e)),this}}],[{key:"version",get:function(){return"1.2.1"}}]),o}()}),window,document);
//# sourceMappingURL=noose.es5.js.map